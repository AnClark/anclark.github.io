<!DOCTYPE html>
<html lang="zh_CN" >
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<title>Makefile 编写时的几个大坑和技巧 - 爱拼安小匠的技术博客</title>
    <link rel="alternate" href="" type="application/atom+xml"/>
	<link rel="shortcut icon" href=""/>
	
<link rel="stylesheet" href="/css/style.css">

	
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
	<div class="main-con">

        <div class="nav cl">
    <ul class="cl nav-list">
        <!-- Customizable nav bar -->
        
            
            <li>
                
                    <a href="/" class="">
                        <i class="fa fa-home"></i> 
                        <span>主页</span>
                    </a>
                
            </li>
            
        
            
            <li>
                
                    <a href="/archives/" class="">
                        <i class=" fa-"></i> 
                        <span>归档</span>
                    </a>
                
            </li>
            
        
            
            <li>
                
                    
                    <a href="javascript:void(0)" class="">
                    
                        <i class=" fa-"></i> 
                        <span>关于</span>
                        <span class="drop-flag fa fa-angle-down"></span>
                    </a>
                    <dl>
                        
                            <li>
                                <a href="/about" class="">
                                    <i class=" fa-"></i>
                                    <span>关于本站</span>
                                </a>
                            </li>
                        
                    </dl>
                
            </li>
            
        
            
            <!-- Language switcher -->

    <li>
        <a href="javascript:void(0)">
            <i class="fa fa-language"></i> 
            
            <span>简体中文</span>
            
            <span class="drop-flag fa fa-angle-down"></span>
        </a>
        <dl>
            
                <li>
                    
                    <a href="/" class="">
                    
                        <i class="fa fa-circle"></i>
                        <span>简体中文</span>
                    </a>
                </li>
            
                <li>
                    
                    <a href="/en/" class="">
                    
                        <i class="fa fa-circle"></i>
                        <span>English</span>
                    </a>
                </li>
            
        </dl>
    </li>

            
        
    </ul>

    <ul class="cl nav-tool">
        
            <li>
                <a href="/github">
                    <i class="fa fa-github"></i>
                </a>
            </li>
        
            <li>
                <a href="/mail">
                    <i class="fa fa-envelope"></i>
                </a>
            </li>
        
            <li>
                <a href="/twitter">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
        
        <li>
            <a href="javascript:void(0)" class="nav-search-btn">
                <i class="fa fa-search"></i>
            </a>
        </li>
        
    </ul>
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="nav-search"><input type="search" name="q" class="nav-search-input" placeholder="search..."><input type="hidden" name="sitesearch" value="https://anclark.github.io"></form>
</div>

        <header class="top" id="fallEle" style="background-image: url(/imgs/head.jpg)">
    <i class="fa fa-bars" id="media-toggle" style="display: none"></i>
    <div class="top-info cl fadeToBottom">
        <h2 class="site-name">
            <a href="/">
                
                    爱拼安小匠的技术博客
                
            </a>
            <small id="type-data">
                
                    
                
            </small>
        </h2>
    </div>
</header>

        <div class="con-wrap fadeToTop">
    
    <section class="article-area">
    
        <article class="article">
    <div class="article-wrap">
        
            <h2 class="article-title cl">
                Makefile 编写时的几个大坑和技巧
            </h2>
        

        <ul class="article-extra" style="margin-bottom: 20px">
            
            <li class="article-time">
                2021-02-09
            </li>
            

            
                
                <li class="article-category">
                    <ol class="category-list cl">
                        <i class="fa fa-folder-o"></i>
                        
                            
                            <li><a href="/categories/编程经验/">编程经验</a></li>
                            
                        
                            
                        
                    </ol>
                </li>
                
            


        </ul>
        <div class="article-description">
            
            <p>这两个月，我做开发的一个重头戏，就是给<a target="_blank" rel="noopener" href="https://zynaddsubfx.sourceforge.net/">Zyn-Fusion</a>重写编译系统。它是强悍的开源合成器ZynAddSubFX的全新界面，酷炫性和专业性并不比Serum、Sylenth这些老牌合成器逊色，有望成为电子音乐人的新宠。然而原作者设计的编译脚本（基于Shell和Ruby）在设计上存在不少问题，导致在Windows（Msys2）和Arch Linux下常常编译失败，因此我决定用Makefile重写编译系统。</p>
<p>就在这过程中，由于Makefile本身具有大量容易被忽略的细节，我在实践的过程中频频踩坑，这也是用Makefile组织有一定规模的编译系统时很容易出现的问题。记在这里，让有幸看到的小伙伴别踩坑了。</p>
<span id="more"></span>

<h2 id="阅读之前先来个术语解释"><a href="#阅读之前先来个术语解释" class="headerlink" title="阅读之前先来个术语解释"></a>阅读之前先来个术语解释</h2><ul>
<li><strong>目标（Target）</strong>：Makefile中用于执行特定任务、生成特定文件的一组程序块，以特定的标识符（目标名加半角冒号）开始，碰到下一个标识符或Makefile语句（如赋值语句、<code>include</code>）结束。</li>
<li><strong>配方（Recipe）</strong>：目标中用于执行具体操作的程序语句，为shell命令，统一以一个制表符开头。</li>
</ul>
<h2 id="第一坑：缩进问题"><a href="#第一坑：缩进问题" class="headerlink" title="第一坑：缩进问题"></a>第一坑：缩进问题</h2><p>除了Python，Makefile是另一个严格要求缩进的编程语言，把缩进视为语法的一部分。更重要的是，Makefile的缩进有这样的特殊规则，堪比大坑：</p>
<ul>
<li>缩进只允许用Tab（制表符），不允许用空格。</li>
<li>缩进后的语句一律视为编译目标的一部分，作为shell语句解释。</li>
</ul>
<p>因此，在Makefile中，用代码缩进增强可读性的方式不管用了。</p>
<p>举一个简单的例子：根据变量<code>ENABLE_OPTIMIZATION</code>定义与否，给<code>CFLAGS</code>赋不同的值。<strong>注意<code>ifdef</code>分支下的语句是没有缩进的。</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-keyword">ifdef</span> ENABLE_OPTIMIZATION<br>CFLAGS += -O3<br><span class="hljs-keyword">else</span><br>CFLAGS += -g -O0<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>

<p>然而，一些像我当时一样的新手可能会觉得可读性不给力，于是习惯性地加上缩进：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-keyword">ifdef</span> ENABLE_OPTIMIZATION<br>	CFLAGS += -O3<br><span class="hljs-keyword">else</span><br>	CFLAGS += -g -O0<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>

<p>这样做会存在一定的风险。</p>
<p><strong>其一，</strong>如果上例放在文件开头，在一些Make版本中不成问题。我目前的Make版本（<code>4.3</code>）仍会正常识别缩进后的赋值语句，而不解释为shell语句。比如这个完整的<code>Makefile</code>：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs makefile">ENABLE_OPTIMIZATION := true<br><br><span class="hljs-keyword">ifdef</span> ENABLE_OPTIMIZATION<br>	CFLAGS += -O3<br><span class="hljs-keyword">else</span><br>	CFLAGS += -g -O0<br><span class="hljs-keyword">endif</span><br><br><span class="hljs-section">all:</span><br>	@echo <span class="hljs-variable">$(CFLAGS)</span><br></code></pre></td></tr></table></figure>

<p>在终端中运行，结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ make<br>-O3<br>$ make ENABLE_OPTIMIZATION=<br>-g -O0<br></code></pre></td></tr></table></figure>

<p>可见结果正常。但无法保证其他版本的Make能正常工作。</p>
<p><strong>其二，</strong>如果上例放在目标当中，条件分支语句仍能正常解析，但被缩进的赋值语句已经被解释成了shell语句，出错是必然的。</p>
<p>略微修改“其一”中的代码清单，改成：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs makefile">ENABLE_OPTIMIZATION := true<br><br><span class="hljs-section">all:</span><br><span class="hljs-keyword">ifdef</span> ENABLE_OPTIMIZATION<br>	CFLAGS += -O3<br><span class="hljs-keyword">else</span><br>	CFLAGS += -g -O0<br><span class="hljs-keyword">endif</span><br><br>	@echo <span class="hljs-variable">$(CFLAGS)</span><br></code></pre></td></tr></table></figure>

<p>在终端中运行，结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ make<br>CFLAGS += -O3<br>make: CFLAGS: No such file or directory<br>make: *** [Makefile:5: all] Error 127<br></code></pre></td></tr></table></figure>

<p>可见，Make把那两句<code>CFLAGS += ...</code>当作一个配方来解析了，不会给变量<code>CFLAGS</code>赋值。</p>
<h2 id="第二坑：不能在目标中使用赋值等Makefile语句"><a href="#第二坑：不能在目标中使用赋值等Makefile语句" class="headerlink" title="第二坑：不能在目标中使用赋值等Makefile语句"></a>第二坑：不能在目标中使用赋值等Makefile语句</h2><p>接着“第一坑：其二”中的例子，如果要在运行目标<code>all</code>时通过条件判断给<code>CFLAGS</code>变量赋值，似乎去掉赋值语句前的缩进就可以了：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs makefile">ENABLE_OPTIMIZATION := true<br><br><span class="hljs-section">all:</span><br><span class="hljs-keyword">ifdef</span> ENABLE_OPTIMIZATION<br>CFLAGS += -O3<br><span class="hljs-keyword">else</span><br>CFLAGS += -g -O0<br><span class="hljs-keyword">endif</span><br><br>	@echo <span class="hljs-variable">$(CFLAGS)</span><br></code></pre></td></tr></table></figure>

<p>但在运行后，却出现了这样的错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Makefile:10: *** recipe commences before first target.  Stop.<br>Makefile:10: *** 配方在第一个目标前开始。 停止。<br></code></pre></td></tr></table></figure>

<p>这是因为在一个目标之下<strong>只能出现配方，而不允许掺杂出现不属于配方的语句（例如赋值语句、<code>include</code>语句）</strong>。条件分支语句虽也允许使用，但在目标中<strong>它只能用于控制在不同条件下执行哪些配方</strong>。在编写Makefile时应当尤其注意这一点。</p>
<h2 id="第三坑：赋值语句的作用域"><a href="#第三坑：赋值语句的作用域" class="headerlink" title="第三坑：赋值语句的作用域"></a>第三坑：赋值语句的作用域</h2><p>其他编程语言中，变量定义没有溯及既往的效力，即定义一个变量后，该变量定义之前的程序代码是不能使用该变量的。然而，Makefile却有，这非常类似于JavaScript函数的“先使用后定义”。且看下面的例子：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">all:</span><br>	@echo <span class="hljs-variable">$(VAR)</span><br><br>VAR := abcdefg<br></code></pre></td></tr></table></figure>

<p>按理来说，变量<code>VAR</code>定义在目标<code>all</code>之后，运行<code>make all</code>应该什么也不会输出。不过，<strong>Makefile的变量允许先使用后定义</strong>，所以运行<code>all</code>时，变量<code>VAR</code>已经被赋值了，最终是有输出的：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile">$ make all<br>abcdefg<br></code></pre></td></tr></table></figure>

<h2 id="第四坑：变量赋值运算符-和"><a href="#第四坑：变量赋值运算符-和" class="headerlink" title="第四坑：变量赋值运算符=和:="></a>第四坑：变量赋值运算符<code>=</code>和<code>:=</code></h2><p>这个坑，先用两个实例来抛砖引玉。</p>
<p><strong>例一：</strong>设计Makefile时，如果要判断当前的系统版本，可以调用系统命令<code>uname</code>，这里假设用下列变量来存贮该命令的输出，并尝试在它们当中搜索字符串<code>&quot;Linux&quot;</code>：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs makefile">UNAME_1	:= `uname -a`<br>UNAME_2	= `uname -a` <br>UNAME_3	:= <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -a)</span><br>UNAME_4	= <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -a)</span><br><br><span class="hljs-section">all:	</span><br>	@echo <span class="hljs-variable">$(<span class="hljs-built_in">findstring</span> Linux,<span class="hljs-variable">$(UNAME_1)</span>)</span><br>	@echo <span class="hljs-variable">$(<span class="hljs-built_in">findstring</span> Linux,<span class="hljs-variable">$(UNAME_2)</span>)</span><br>	@echo <span class="hljs-variable">$(<span class="hljs-built_in">findstring</span> Linux,<span class="hljs-variable">$(UNAME_3)</span>)</span><br>	@echo <span class="hljs-variable">$(<span class="hljs-built_in">findstring</span> Linux,<span class="hljs-variable">$(UNAME_4)</span>)</span><br></code></pre></td></tr></table></figure>

<p>运行结果如下。可见，只有<code>UNAME_4</code>的值能最终被<code>$(findstring)</code>函数正常识别并工作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><br><br>Linux<br></code></pre></td></tr></table></figure>

<p><strong>例二：</strong>在定义变量A时，有时需要先用其他的变量B、C给该变量赋值，但B、C的值不能马上确定。Makefile允许先使用后定义变量，但运算符的不同会影响到预期结果的实现。见下例：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile">BUILD_TARGET_1	:= build-zynaddsubfx-<span class="hljs-variable">$(OS)</span>-<span class="hljs-variable">$(TYPE)</span><br>BUILD_TARGET_2	= build-zynaddsubfx-<span class="hljs-variable">$(OS)</span>-<span class="hljs-variable">$(TYPE)</span><br>OS	:= linux<br>TYPE	:= debug<br><br><span class="hljs-section">all:</span><br>	@echo <span class="hljs-variable">$(BUILD_TARGET_1)</span><br>	@echo <span class="hljs-variable">$(BUILD_TARGET_2)</span><br></code></pre></td></tr></table></figure>

<p>最终输出结果如下。可见，只有使用了<code>=</code>运算符的<code>BUILD_TARGET_2</code>得到了正确的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">build-zynaddsubfx--<br>build-zynaddsubfx-linux-debug<br></code></pre></td></tr></table></figure>

<p>从上述两个例子中不难推知，运算符<code>=</code>和<code>:=</code>在变量赋值的过程中作用千差万别。</p>
<p>如果定义变量A时使用了其他的变量B，那么：</p>
<ul>
<li><code>:=</code>运算符只会把变量B<strong>简单展开一次</strong>（simply expanded）。这要求变量B必须先定义。</li>
<li><code>=</code>运算符则会<strong>递归展开</strong>（recursively expanded）。这允许变量先定义后使用。</li>
</ul>
<blockquote>
<p><strong>注意：</strong></p>
<ul>
<li>如果想给当前变量的值添加新字符，则必须使用<code>:=</code>，例如<code>CFLAGS := $(CFLAGS) -O3</code>。这种情况下，使用<code>=</code>会导致死循环。</li>
<li>Make版本更新到<code>4.3</code>后，似乎无论是<code>:=</code>还是<code>=</code>，都能够用来以函数的输出结果给变量赋值了。此前只能使用<code>=</code>。</li>
</ul>
</blockquote>
<h2 id="第五坑：如何保证不再重新生成一个目标（例如文件下载）"><a href="#第五坑：如何保证不再重新生成一个目标（例如文件下载）" class="headerlink" title="第五坑：如何保证不再重新生成一个目标（例如文件下载）"></a>第五坑：如何保证不再重新生成一个目标（例如文件下载）</h2><p>Make能够判断一个目标是否应该重新生成：如果源文件进行了修改，或目标文件被删除，则重新生成；否则保持原样。这个特性能够确保在只修改个别文件时，不至于一股脑儿全都重新编译，有助于保证程序员的工作效率。</p>
<p>但是，上述特性似乎只适用于编译，对于一些特殊的场合则不管用。例如编写一个下载文件的目标，让Make在检测到文件存在时不再重新下载：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">download/test.gz:</span><br>	wget http://somewhere.org/test.gz -O <span class="hljs-variable">$@</span>    <span class="hljs-comment"># $@ 为内置变量，自动设为目标名</span><br></code></pre></td></tr></table></figure>

<p>然而事实上，Make总是会无条件重新生成这个目标，也就是总会重新下载<code>test.gz</code>这个文件。实践中，这非常不利于资源利用，同时给网络环境不理想的用户造成了麻烦。</p>
<p>有鉴于此，我们应该在该目标中，手动判断文件是否存在，如果不存在则重新下载。修改上述代码清单如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">download/test.gz:</span><br><span class="hljs-keyword">ifeq</span> (, <span class="hljs-variable">$(<span class="hljs-built_in">wildcard</span> <span class="hljs-variable">$@</span>)</span>)<br>	wget http://somewhere.org/test.gz -O <span class="hljs-variable">$@</span>    <span class="hljs-comment"># $@ 为内置变量，自动设为目标名</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>

<p>这里，<code>$(wildcard)</code>函数返回一个文件列表的字符串，可用来判断文件是否存在，不存在则自然返回空值。条件判断语句<code>ifeq</code>比较两个表达式是否相等，第一个表达式为空。连起来，则是判断<code>$(wildcard)</code>是否返回空值，一旦返回空值，则目标文件不存在，应当重新下载。</p>
<p>到此，Make不至于反复重新下载我们需要的文件了。</p>
<blockquote>
<p><strong>注意：</strong>一般情况下<code>wget</code>会在下载出错时删除未下载完成的文件，但有时却不会删除。因此还需自行编写检查文件有效性的代码。</p>
</blockquote>
<h2 id="第六坑：在Makefile编译目标中使用cd等Shell命令"><a href="#第六坑：在Makefile编译目标中使用cd等Shell命令" class="headerlink" title="第六坑：在Makefile编译目标中使用cd等Shell命令"></a>第六坑：在Makefile编译目标中使用<code>cd</code>等Shell命令</h2><p>在编写一些目标时，有时会需要切换到一个特定目录下进行操作，比如运行某个子目录中子项目的<code>configure</code>：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">build_libuv:</span><br>	cd libuv<br>	./configure<br></code></pre></td></tr></table></figure>

<p>但是上面这种写法，一旦运行就直接提示“找不到<code>./configure</code>”。这是因为Makefile的目标中，<strong>每一个配方都被视为一个独立的shell脚本，在不同的shell会话中运行</strong>，以便处理并行任务。</p>
<p>也正因如此，在使用<code>cd</code>等要在同一个shell会话中运行的命令时，应当把它们写在同一行中。就像这样：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">build_libuv:</span><br><span class="hljs-comment"># 第一种写法，用&quot;&amp;&amp;&quot;分隔多个命令</span><br>	cd libuv &amp;&amp; ./configure<br><span class="hljs-comment"># 第二种写法，也可用分号分隔</span><br>	cd libuv; ./configure<br></code></pre></td></tr></table></figure>

<p>也可拆成多行，用反斜杠<code>\</code>断行。在书写多条命令或较长命令时会显得非常清爽。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">build_libuv:</span><br>	cd libuv ; \<br>	./configure<br></code></pre></td></tr></table></figure>

<h2 id="第七坑：调用子Makefile"><a href="#第七坑：调用子Makefile" class="headerlink" title="第七坑：调用子Makefile"></a>第七坑：调用子Makefile</h2><p>有些大型的项目包含若干个子项目，每个项目都有自己的<code>Makefile</code>。如果想要调用子项目的<code>Makefile</code>，正确的做法并不是使用<code>include</code>语句，而是用<code>make</code>命令。</p>
<p>比如，项目<code>Test</code>的结构如图所示，包含两个子项目<code>doc</code>和<code>src</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Test/<br>├─doc/<br>│ └─Makefile<br>├─Makefile<br>└─src/<br>  └─Makefile<br></code></pre></td></tr></table></figure>

<p>如果想编译<code>doc</code>和<code>src</code>，则在<code>Test/Makefile</code>中编写这样的目标：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">build_doc:</span><br>	<span class="hljs-variable">$(MAKE)</span> -C doc<br><span class="hljs-section">build_src:</span><br>	<span class="hljs-variable">$(MAKE)</span> -C src<br></code></pre></td></tr></table></figure>

<p>即，运行一个新的<code>make</code>程序，切换到对应目录下并读取其<code>Makefile</code>。<code>$(MAKE)</code>为内置变量，指向用于运行当前Makefile的<code>make</code>命令路径。</p>
<h2 id="对了……还有！"><a href="#对了……还有！" class="headerlink" title="对了……还有！"></a>对了……还有！</h2><p>如果想参考我的实践成果，或是自己编译Zyn-Fusion来玩音乐，不妨移步我fork的Repo：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/anclark/zyn-fusion-build">Zyn-Fusion 编译脚本Repo</a></li>
</ul>

        </div>
        
        
        
        <div class="article-tags">
            <ul class="tags-list cl">
                
                <li><a href="/tags/技术笔记/"><i class="fa fa-tag"></i>技术笔记</a></li>
                
                <li><a href="/tags/Makefile/"><i class="fa fa-tag"></i>Makefile</a></li>
                
            </ul>
        </div>
        
        <div class="article-pagination cl">
        
            <div class="pagination-prev">
                <a href="/2021/02/12/Git/Git_Sync_Commits/">GitHub：如何只提交/应用指定commit（Pull Request，或更新本地代码）</a>
            </div>
        
        
            <div class="pagination-next">
                <a href="/2020/12/11/Struggle_with_Linux/%E8%A7%A3%E5%86%B3Linux%E4%B8%8Bzip%E5%8E%8B%E7%BC%A9%E5%8C%85%E4%B9%B1%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98/">解决Linux下ZIP压缩包乱码的问题</a>
            </div>
        
        </div>

        
    </div>
</article>

    </section>
    
<section class="tool-area">

    <div class="toolbar">
        

        
        <div class="widget-post widget" style="order: 1 ">
            <h2 class="widget-title"><i class="fa fa-file-text"></i> 近期文章</h2>
            <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/04/26/BlackMacOS/Tianocore_On_Hard_Drive/">把Tianocore装到GPT硬盘中，让BIOS老机器跑上UEFI</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/26/BlackMacOS/Tianocore_On_USB_Drive/">U盘安装Tianocore，让BIOS老机器跑上UEFI</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/12/Git/Git_Sync_Commits/">GitHub：如何只提交/应用指定commit（Pull Request，或更新本地代码）</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/09/Programming_Tips/Makefile_%E8%B8%A9%E5%9D%91%E8%AE%B0/">Makefile 编写时的几个大坑和技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/11/Struggle_with_Linux/%E8%A7%A3%E5%86%B3Linux%E4%B8%8Bzip%E5%8E%8B%E7%BC%A9%E5%8C%85%E4%B9%B1%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98/">解决Linux下ZIP压缩包乱码的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/09/Linux_Audio_Production/Make_Your_ArchLinux_An_Audio_Workstation_03.md/">把Arch Linux打造成音乐工作站（三）：使用Windows下的VST插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/08/Linux_Audio_Production/Make_Your_ArchLinux_An_Audio_Workstation_01/">把Arch Linux打造成音乐工作站（一）：安装与配置JACK</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/25/Linux_Audio_Production/Make_Your_ArchLinux_An_Audio_Workstation_02/">把Arch Linux打造成音乐工作站（二）：安装WineASIO</a></li></ul>
        </div>
        

        
        <div class="widget-tags widget" style="order: 2 ">
            <h2 class="widget-title"><i class="fa fa-tags"></i> 标签</h2>
            <a href="/tags/ASIO/" style="font-size: 10px;">ASIO</a> <a href="/tags/Android-%E9%80%82%E9%85%8D/" style="font-size: 10px;">Android 适配</a> <a href="/tags/Android-%E9%80%82%E9%85%8D%E6%95%99%E7%A8%8B/" style="font-size: 13.33px;">Android 适配教程</a> <a href="/tags/Android-%E9%80%82%E9%85%8D%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">Android 适配笔记</a> <a href="/tags/Apache2/" style="font-size: 10px;">Apache2</a> <a href="/tags/Arch-Linux/" style="font-size: 13.33px;">Arch Linux</a> <a href="/tags/BIOS/" style="font-size: 13.33px;">BIOS</a> <a href="/tags/BusyBox/" style="font-size: 10px;">BusyBox</a> <a href="/tags/Cherry-Pick/" style="font-size: 10px;">Cherry Pick</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Deepin/" style="font-size: 16.67px;">Deepin</a> <a href="/tags/Foobar2000/" style="font-size: 10px;">Foobar2000</a> <a href="/tags/GPT/" style="font-size: 10px;">GPT</a> <a href="/tags/GitHub/" style="font-size: 10px;">GitHub</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hexo%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">Hexo插件</a> <a href="/tags/IPv6/" style="font-size: 10px;">IPv6</a> <a href="/tags/JACK/" style="font-size: 10px;">JACK</a> <a href="/tags/KDE/" style="font-size: 10px;">KDE</a> <a href="/tags/Linux/" style="font-size: 16.67px;">Linux</a> <a href="/tags/Linux-%E5%AE%89%E8%A3%85/" style="font-size: 10px;">Linux 安装</a> <a href="/tags/MBR/" style="font-size: 13.33px;">MBR</a> <a href="/tags/Mac-OS/" style="font-size: 10px;">Mac OS</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/NAS/" style="font-size: 10px;">NAS</a> <a href="/tags/OMV/" style="font-size: 10px;">OMV</a> <a href="/tags/OpenSUSE/" style="font-size: 10px;">OpenSUSE</a> <a href="/tags/OpenWrt/" style="font-size: 10px;">OpenWrt</a> <a href="/tags/Openmediavault/" style="font-size: 10px;">Openmediavault</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Pull-Request/" style="font-size: 10px;">Pull Request</a> <a href="/tags/PyAudio/" style="font-size: 10px;">PyAudio</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/RIME/" style="font-size: 10px;">RIME</a> <a href="/tags/SDL/" style="font-size: 10px;">SDL</a> <a href="/tags/Snap/" style="font-size: 10px;">Snap</a> <a href="/tags/Snapd/" style="font-size: 10px;">Snapd</a> <a href="/tags/TWRP/" style="font-size: 13.33px;">TWRP</a> <a href="/tags/UEFI/" style="font-size: 13.33px;">UEFI</a> <a href="/tags/Ubuntu/" style="font-size: 13.33px;">Ubuntu</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/VST/" style="font-size: 10px;">VST</a> <a href="/tags/Wine/" style="font-size: 13.33px;">Wine</a> <a href="/tags/ZIP/" style="font-size: 10px;">ZIP</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/%E4%B9%B1%E7%A0%81/" style="font-size: 10px;">乱码</a> <a href="/tags/%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">使用技巧</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 10px;">内核</a> <a href="/tags/%E5%8E%8B%E7%BC%A9%E5%8C%85/" style="font-size: 10px;">压缩包</a> <a href="/tags/%E5%9E%82%E7%9B%B4%E5%90%8C%E6%AD%A5/" style="font-size: 10px;">垂直同步</a>
        </div>
        

        
        <div class="widget-categories widget" style="order: 3 ">
            <h2 class="widget-title"><i class="fa fa-folder-open"></i> 分类</h2>
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/%E9%80%82%E9%85%8D/">适配</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/%E9%80%82%E9%85%8D/%E6%95%99%E7%A8%8B/">教程</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/%E9%80%82%E9%85%8D/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">7</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/%E6%8F%92%E4%BB%B6/">插件</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Arch-Linux/">Arch Linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Deepin/">Deepin</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/OpenSUSE/">OpenSUSE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Ubuntu/">Ubuntu</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Ubuntu/Snap/">Snap</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/npm/">npm</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SDL/">SDL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Switch/">Switch</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Switch/%E5%BC%80%E5%8F%91/">开发</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Mac-OS/">Mac OS</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Mac-OS/%E9%BB%91%E8%8B%B9%E6%9E%9C/">黑苹果</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/UEFI/">UEFI</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%A9%E8%BD%ACNAS/">玩转NAS</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%A9%E8%BD%ACNAS/Openmediavault/">Openmediavault</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%B5%E8%84%91%E7%BB%B4%E4%BF%AE/">电脑维修</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%B5%E8%84%91%E7%BB%B4%E4%BF%AE/%E6%95%85%E9%9A%9C%E8%A7%A3%E5%86%B3/">故障解决</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%BB%8F%E9%AA%8C/">编程经验</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%BB%8F%E9%AA%8C/Makefile/">Makefile</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87%E6%8A%A5%E5%91%8A/">论文报告</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87%E6%8A%A5%E5%91%8A/%E5%8F%8C%E5%AD%A6%E4%BD%8D%E8%AE%BA%E6%96%87/">双学位论文</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9F%B3%E4%B9%90%E5%88%B6%E4%BD%9C/">音乐制作</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9F%B3%E4%B9%90%E5%88%B6%E4%BD%9C/Linux%E4%B8%8B%E5%81%9A%E9%9F%B3%E4%B9%90/">Linux下做音乐</a><span class="category-list-count">3</span></li></ul></li></ul>
        </div>
        

    </div>
</section>
</div>

    
        <footer class="footer">
	<p class="footer-intro">
		
		@2022 爱拼安小匠的技术博客.
	</p>
	<p class="footer-intro">
			Powered By <a href="https://hexo.io/zh-cn/" target="_blank">hexo</a>
			theme <a href="https://github.com/iengu/hexo-theme-mokusei" target="_blank">mokusei</a> by <a href="https://www.iengu.com" target="blank">iengu</a>
	</p>
</footer>




        <div class="extend-tools" id="extend-tools" style="display: none;">
    <ul>
        <li class="tools-returnTop" title="返回顶部"><i class="fa fa-angle-double-up"></i></li>
    </ul>
</div>

	</div>

	
<script src="/js/org/jquery.min.js"></script>

    
<script src="/js/extend.js"></script>

</body>
</html>